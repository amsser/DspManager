'use strict';

var db = require('../lib/db').db;
var accounting = require('accounting');
var auth = require('../lib/auth');


module.exports = function(app) {

	app.get('/import', function(req, res) {


		var gr = function(x, y) {
			return accounting.toFixed(x * (((Math.random() * 2) - 1) + 1), y);
		}

		var seeddoc = [
			[3053114.00, 2913.00, 1241.21, 0.00, 710541.00, 0.43, 0.41],
			[1422625.00, 1305.00, 519.80, 0.00, 323167.00, 0.40, 0.37],
			[797995.00, 678.00, 272.68, 0.00, 175746.00, 0.40, 0.34],
			[570666.00, 548.00, 231.52, 0.00, 121775.00, 0.42, 0.41],
			[623543.00, 601.00, 256.96, 0.00, 135818.00, 0.43, 0.41],
			[1306674.00, 1331.00, 542.35, 0.00, 298027.00, 0.41, 0.42],
			[3349592.00, 3060.00, 1299.55, 0.00, 784189.00, 0.42, 0.39],
			[9923978.00, 8200.00, 3264.83, 0.00, 2330594.00, 0.40, 0.33],
			[27926522.00, 24196.00, 6408.56, 0.00, 5932503.00, 0.26, 0.23],
			[27970019.00, 20670.00, 3724.89, 0.00, 4528678.00, 0.18, 0.13],
			[27331600.00, 19992.00, 3778.23, 0.00, 4705093.00, 0.19, 0.14],
			[25357018.00, 16028.00, 3072.56, 0.00, 4159656.00, 0.19, 0.12],
			[19988369.00, 9593.00, 1552.41, 0.00, 2446126.00, 0.16, 0.08],
			[18447428.00, 9676.00, 1545.93, 0.00, 2265646.00, 0.16, 0.08],
			[22086773.00, 15886.00, 2440.00, 0.00, 3158959.00, 0.15, 0.11],
			[23074812.00, 16015.00, 2327.98, 0.00, 3046965.00, 0.15, 0.10],
			[22465193.00, 13704.00, 1388.18, 0.00, 1981634.00, 0.10, 0.06],
			[17680151.00, 10441.00, 1046.77, 0.00, 1540888.00, 0.10, 0.06],
			[12226408.00, 6740.00, 1089.43, 0.00, 1498566.00, 0.16, 0.09],
			[12574795.00, 6960.00, 2244.61, 0.00, 2748437.00, 0.32, 0.18],
			[13921338.00, 7775.00, 2689.68, 0.00, 3026113.00, 0.35, 0.19],
			[11924324.00, 7473.00, 2125.98, 0.00, 2373427.00, 0.28, 0.18],
			[10448105.00, 6547.00, 1959.48, 0.00, 2287536.00, 0.30, 0.19],
			[6189811.00, 4186.00, 1315.80, 0.00, 1435714.00, 0.31, 0.21]
		];

		var docs = [];

		//parseFloat(accounting.toFixed((item.Click / item.Display) * 10000, 2))

		for (var j = 1; j < 8; j++) {

			for (var i = 0; i < 24; i++) {

				var hd = seeddoc[i];

				var doc = {
					"Hour": i < 10 ? "0" + i : "" + i,
					"Date": "2014-05-0" + j,
					"Display": parseInt(gr(hd[0], 0)),
					"Click": parseInt(gr(hd[1], 0)),
					"ClickRatio": parseFloat(gr(0.00146 * 10000, 2)),
					"Arrive": parseInt(gr(hd[4], 0)),
					"ArriveRatio": parseFloat(gr(0.985 * 10000, 2)),
					"Trans": parseInt(gr(98, 0)),
					"TransRatio": parseFloat(gr(0.013 * 10000, 2)),
					"CPC": parseFloat(gr(hd[5], 2)),
					"CPM": parseFloat(gr(hd[6], 2)),
					"CPA": parseFloat(gr(hd[6], 2)),
					"Cost": parseFloat(gr(hd[2], 2)),
					"CostRatio": parseFloat(gr(0.432, 2))
				};
				docs.push(doc);
			}

		}

		console.log('Import start...');

		db().collection('dashboard').remove({}, function(err, result) {

			console.log('Remove All');

			console.log(docs);

			db().collection('dashboard').insert(docs, function(err, result) {
				console.log('Import Finished');

				res.send("success");

			});



		});



	});

};